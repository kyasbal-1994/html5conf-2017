# 実行時のパフォーマンス問題

* 「テクスチャが重いからjpgにしよう」
    * WebGL上で使う上では最善策ではない
    * JPGはCPU上で**デコードされてフルサイズでGPUに乗る**
    * いくつかのフォーマットは圧縮されたままVRAMに乗せることができる

# テクスチャ圧縮

* **GPUやドライバによってサポートされている形式が違う**
* 圧縮テクスチャ形式
    * S3TC
    * ETC
    * PVRTC

# テクスチャ圧縮

* 一概にはいえないが、OSやデバイスごとのサポート率で見ると
    * iOSにはPVRTC形式
    * AndroidにはETC形式
    * PC向けにはS3TC形式

* それぞれの形式で圧縮して、対応しているエクステンションごとにリクエストする必要がある

# テクスチャ圧縮の例

![big-image](./resources/size.jpg)

* 4096 * 2048px (703kb(.jpg)/ 5.5MB(.png))

# テクスチャ圧縮の例

* RGBAに展開される時 8bit \* 4チャンネル \* (2048 \* 4096) px = **約33MB**
* もしもモデルのテクスチャならさらに法線マップやエミッションマップ、ラフネスマップがある
* 圧縮テクスチャなら
    * S3TC DXT2 **5.6MB**
    * PVRTC 4bpp **5.6MB** 2bpp **2.8MB**
    * ETC **5.6MB**

# テクスチャ圧縮

* 特にモバイルではメモリの食い過ぎを防げる
* VRAMへの転送が早くなるので高速化につながる

# エクステンションでの高速化

* 本来はWebGL2.0で使えるもの
* **OES\_vertex\_array\_obect**拡張で使える(96%)
![](https://i.gyazo.com/c4d23c98d8ea64f418fbe75954fba7f6.png)
> 引用:http://www.openglsuperbible.com/

# エクステンションでの高速化

* 本来はWebGL2.0で使えるものでエクステンション次第で使えるもの
* **ANGLE\_instanced\_arrays**(93%) パーティクルなどの演出で使える
(フォールバックが極めて面倒)
* **OES\_texture\_float**(76%(少し前まで95%だったはず...))
* **WEBGL\_draw\_buffers**(デスクトップで68%)

# エクステンションでの高速化

* エクステンションでの高速化はフォールバックが面倒
* ライブラリが勝手にやって欲しいが、どのエクステンションを使っているかはユーザーが知っておきたい